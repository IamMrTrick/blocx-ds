/* Drawer Component - Modern glassmorphism design with smooth animations */

.drawer {
  /* Local vars - Enhanced for modern look */
  --_backdrop-bg: var(--transparent-black-50);
  --_backdrop-blur: blur(12px);
  --_panel-bg: var(--color-surface);
  --_panel-bg-dark: var(--bg-primary);
  --_panel-color: var(--color-text);
  --_panel-radius: var(--gl-radius-wrapper);
  --_panel-border: 1px solid var(--color-border-subtle);
  --_panel-border-dark: 1px solid var(--border-secondary);
  --_shadow: 0 32px 64px var(--shadow-lg), 
             0 16px 32px var(--shadow-md),
             0 8px 16px var(--shadow-sm);
  --_shadow-hover: 0 40px 80px var(--shadow-xl), 
                   0 20px 40px var(--shadow-lg),
                   0 10px 20px var(--shadow-md);
  --_gap: var(--spacing-12);
  --_pad: var(--spacing-20);
  --_panel-w: min(86vw, 420px);
  --_panel-h: 75vh;

  position: fixed;
  inset: 0;
  z-index: var(--z-drawer);
  display: block; /* Keep in DOM to allow transition from initial transform */
  pointer-events: none; /* Disabled until open */
  overflow: clip; /* Prevent any overflow issues and avoid scrollbars on transform */
}

.drawer--open { 
  pointer-events: auto;
}

.drawer__backdrop {
  position: absolute;
  inset: 0;
  background: var(--_backdrop-bg);
  backdrop-filter: var(--_backdrop-blur) saturate(120%);
  -webkit-backdrop-filter: var(--_backdrop-blur) saturate(120%);
  opacity: 0;
  transition: opacity 0.3s ease-out;
}

.drawer--open .drawer__backdrop { 
  opacity: 1; 
}

.drawer__panel {
  position: absolute;
  background: var(--_panel-bg);
  color: var(--_panel-color);
  border: var(--_panel-border);
  border-radius: var(--_panel-radius);
  box-shadow: var(--_shadow);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  display: flex;
  flex-direction: column;
  gap: var(--_gap);
  padding: var(--_pad);
  /* Transition moved to separate rule */
  will-change: transform, opacity;
  overflow: hidden; /* Ensure panel doesn't cause page overflow */
  max-width: 100vw;
  max-height: 100vh;
  contain: layout paint size style; /* isolate for perf */
}

/* Dark mode support */
@media (prefers-color-scheme: dark) {
  .drawer__panel {
    background: var(--_panel-bg-dark);
    border: var(--_panel-border-dark);
  }
}

/* Sides with smooth drawer-like sliding */
.drawer--side-left .drawer__panel {
  inset-block: 0;
  inset-inline-start: 0;
  width: var(--_panel-w);
  border-top-left-radius: 0;
  border-bottom-left-radius: 0;
  transform-origin: left center;
  transform: translate3d(-100%, 0, 0);
  opacity: 0;
}

.drawer--side-right .drawer__panel {
  inset-block: 0;
  inset-inline-end: 0;
  width: var(--_panel-w);
  border-top-right-radius: 0;
  border-bottom-right-radius: 0;
  transform-origin: right center;
  transform: translate3d(100%, 0, 0);
  opacity: 0;
}

.drawer--side-top .drawer__panel {
  inset-inline: 0;
  inset-block-start: 0;
  height: var(--_panel-h);
  border-top-left-radius: 0;
  border-top-right-radius: 0;
  transform-origin: center top;
  transform: translate3d(0, -100%, 0);
  opacity: 0;
}

.drawer--side-bottom .drawer__panel {
  inset-inline: 0;
  inset-block-end: 0;
  height: var(--_panel-h);
  border-bottom-left-radius: 0;
  border-bottom-right-radius: 0;
  transform-origin: center bottom;
  transform: translate3d(0, 100%, 0);
  opacity: 0;
}

.drawer__panel {
  /* Always have transition for smooth animations */
  transition: transform 0.36s cubic-bezier(0.22, 1, 0.36, 1), /* easeOutQuint like iOS */
              opacity 0.24s var(--ease-out),
              box-shadow 0.24s var(--ease-out);
  will-change: transform, opacity;
  backface-visibility: hidden;
}



.drawer--open .drawer__panel {
  opacity: 1;
  transform: translate3d(0, 0, 0);
  box-shadow: var(--_shadow-hover);
}

/* Hover effects for interactive elements */
.drawer__panel:hover {
  box-shadow: var(--_shadow-hover);
}

/* Sizes (affect width/height depending on side) */
.drawer--size-s.drawer--side-left .drawer__panel,
.drawer--size-s.drawer--side-right .drawer__panel { width: min(78vw, 340px); }
.drawer--size-m.drawer--side-left .drawer__panel,
.drawer--size-m.drawer--side-right .drawer__panel { width: min(86vw, 420px); }
.drawer--size-l.drawer--side-left .drawer__panel,
.drawer--size-l.drawer--side-right .drawer__panel { width: min(92vw, 520px); }
.drawer--size-xl.drawer--side-left .drawer__panel,
.drawer--size-xl.drawer--side-right .drawer__panel { width: min(96vw, 680px); }

.drawer--size-s.drawer--side-top .drawer__panel,
.drawer--size-s.drawer--side-bottom .drawer__panel { height: 55vh; }
.drawer--size-m.drawer--side-top .drawer__panel,
.drawer--size-m.drawer--side-bottom .drawer__panel { height: 65vh; }
.drawer--size-l.drawer--side-top .drawer__panel,
.drawer--size-l.drawer--side-bottom .drawer__panel { height: 75vh; }
.drawer--size-xl.drawer--side-top .drawer__panel,
.drawer--size-xl.drawer--side-bottom .drawer__panel { height: 88vh; }

.drawer--fullscreen .drawer__panel {
  inset: 0;
  border-radius: 0;
}

.drawer__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.drawer__title { margin: 0; font-size: var(--text-lg-size); line-height: var(--text-lg-line); }
.drawer__description { margin: 0; color: var(--text-secondary); font-size: var(--text-sm-size); line-height: var(--text-sm-line); }
.drawer__body { overflow: auto; }
.drawer__footer { display: flex; justify-content: flex-end; gap: var(--spacing-8); }

/* Improve touch behavior for swipes */
.drawer__panel {
  touch-action: none; /* Enable custom drag gestures */
  cursor: grab;
}

.drawer__panel:active {
  cursor: grabbing;
}

/* Advanced drag visual feedback */
.drawer__panel[data-dragging="true"] {
  transition: transform 0s linear, opacity 0s linear; /* Ensure no cross-fade */
}

/* Ensure content remains clickable */
.drawer__panel > *:not(.drawer__drag-indicator) {
  pointer-events: auto;
  position: relative;
  z-index: 10;
}

/* Wrong direction drag feedback - subtle visual cue */
/* Removed wrong-direction feedback at start to prevent flicker on first touch */

/* Drag indicator - shows progress and direction */
.drawer__drag-indicator {
  position: absolute;
  z-index: 10;
  pointer-events: none;
  
  /* Base styles for all sides */
  background: linear-gradient(
    90deg, 
    rgba(var(--accent-rgb, 59, 130, 246), 0.1) 0%,
    rgba(var(--accent-rgb, 59, 130, 246), 0.3) 50%,
    rgba(var(--accent-rgb, 59, 130, 246), 0.1) 100%
  );
  border-radius: var(--radius-full);
}

/* Drag indicator positioning by side */
.drawer__drag-indicator[data-side="left"] {
  top: 50%;
  right: var(--spacing-16);
  width: 4px;
  height: 60px;
  transform: translateY(-50%);
}

.drawer__drag-indicator[data-side="right"] {
  top: 50%;
  left: var(--spacing-16);
  width: 4px;
  height: 60px;
  transform: translateY(-50%);
}

.drawer__drag-indicator[data-side="top"] {
  bottom: var(--spacing-16);
  left: 50%;
  width: 60px;
  height: 4px;
  transform: translateX(-50%);
}

.drawer__drag-indicator[data-side="bottom"] {
  top: var(--spacing-16);
  left: 50%;
  width: 60px;
  height: 4px;
  transform: translateX(-50%);
}

/* Progress bar within indicator */
.drawer__drag-progress {
  position: absolute;
  background: var(--accent-primary, #3b82f6);
  border-radius: inherit;
  transition: all 0.1s ease-out;
  box-shadow: 0 0 8px rgba(var(--accent-rgb, 59, 130, 246), 0.4);
  
  /* Pulsing effect based on resistance */
  animation: dragPulse 0.3s ease-in-out infinite alternate;
}

/* Progress direction by side */
.drawer__drag-indicator[data-side="left"] .drawer__drag-progress,
.drawer__drag-indicator[data-side="right"] .drawer__drag-progress {
  bottom: 0;
  left: 0;
  right: 0;
  height: var(--progress, 0%);
}

.drawer__drag-indicator[data-side="top"] .drawer__drag-progress,
.drawer__drag-indicator[data-side="bottom"] .drawer__drag-progress {
  left: 0;
  top: 0;
  bottom: 0;
  width: var(--progress, 0%);
}

@keyframes dragPulse {
  from { 
    opacity: 0.6;
    transform: scale(1);
  }
  to { 
    opacity: 1;
    transform: scale(calc(1 + (1 - var(--resistance, 1)) * 0.2));
  }
}

/* Add subtle animations to header elements */
.drawer__header {
  border-bottom: 1px solid rgba(0, 0, 0, 0.08);
  padding-bottom: var(--spacing-12);
  margin-bottom: var(--spacing-16);
}

@media (prefers-color-scheme: dark) {
  .drawer__header {
    border-bottom-color: rgba(255, 255, 255, 0.08);
  }
}

.drawer__title {
  font-weight: 600;
  letter-spacing: -0.025em;
}

.drawer__description {
  margin-top: var(--spacing-4);
}

.drawer__footer {
  border-top: 1px solid rgba(0, 0, 0, 0.08);
  padding-top: var(--spacing-16);
  margin-top: var(--spacing-16);
}

@media (prefers-color-scheme: dark) {
  .drawer__footer {
    border-top-color: rgba(255, 255, 255, 0.08);
  }
}

/* Smooth entrance animation with stagger */
.drawer--open .drawer__header {
  animation: slideInFade 0.3s cubic-bezier(0.25, 0.1, 0.25, 1) 0.15s both;
}

.drawer--open .drawer__body {
  animation: slideInFade 0.3s cubic-bezier(0.25, 0.1, 0.25, 1) 0.2s both;
}

.drawer--open .drawer__footer {
  animation: slideInFade 0.3s cubic-bezier(0.25, 0.1, 0.25, 1) 0.25s both;
}

@keyframes slideInFade {
  from {
    opacity: 0;
    transform: translateY(4px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
  .drawer__backdrop, .drawer__panel { transition: none; }
}


