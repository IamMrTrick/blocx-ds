/* ===== Navigation Component ===== */
.nav {
  position: relative;
  z-index: var(--z-navigation);
  
  /* ===== Layout Options ===== */
  &--layout-gap {
    .nav__list {
      justify-content: flex-start;
    }
  }
  
  &--layout-space-between {
    .nav__list {
      justify-content: space-between;
    }
  }
  
  &--layout-space-around {
    .nav__list {
      justify-content: space-around;
    }
  }
  
  &--layout-space-evenly {
    .nav__list {
      justify-content: space-evenly;
    }
  }
  
  /* ===== Gap Sizes ===== */
  &--gap-sm .nav__list { gap: var(--spacing-8); }
  &--gap-md .nav__list { gap: var(--spacing-16); }
  &--gap-lg .nav__list { gap: var(--spacing-24); }
  &--gap-xl .nav__list { gap: var(--spacing-32); }
  
  /* ===== Trigger Modes ===== */
  &--trigger-hover {
    /* Main level items only */
    > .nav__list > .nav__item--has-children {
      &:hover > .nav__link .nav__chevron {
        transform: rotate(180deg);
      }
      
      /* Open dropdown on hover */
      &:hover > .nav__dropdown {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }
    }
    
    /* Nested dropdown chevrons rotate -90deg for side opening */
    .nav__dropdown .nav__item--has-children {
      &:hover > .nav__link .nav__chevron {
        transform: rotate(-90deg);
      }
      
      /* Open nested dropdown on hover */
      &:hover > .nav__dropdown {
        opacity: 1;
        visibility: visible;
        transform: translateX(0);
      }
    }
  }
  
  &--trigger-click {
    /* Main level items only */
    > .nav__list > .nav__item--has-children {
      .nav__link {
        cursor: pointer;
      }
      
      &.nav__item--dropdown-open > .nav__link .nav__chevron {
        transform: rotate(180deg);
      }
    }
    
    /* Nested dropdown chevrons rotate -90deg for side opening */
    .nav__dropdown .nav__item--has-children {
      .nav__link {
        cursor: pointer;
      }
      
      &.nav__item--dropdown-open > .nav__link .nav__chevron {
        transform: rotate(-90deg);
      }
    }
  }

  /* ===== Variants ===== */
  &--horizontal {
    .nav__list {
      display: flex;
      align-items: center;
      gap: var(--nav-gap);
      flex-wrap: wrap;
    }
    
    .nav__dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      /* Slightly overlap the trigger to avoid hover gaps */
      margin-top: -2px;
      min-width: 220px;
      max-width: 320px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-primary);
      border-radius: var(--nav-submenu-radius);
      box-shadow: var(--nav-submenu-shadow);
      backdrop-filter: blur(20px);
      opacity: 0;
      visibility: hidden;
      transform: translateY(-8px);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: calc(var(--z-navigation) + 1);
      
      &--open {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }
      
      /* Multi-level dropdowns */
      .nav__dropdown {
        top: 0;
        left: 100%;
        /* Slight overlap towards parent to avoid diagonal gap */
        margin-left: -2px;
        background: var(--bg-tertiary);
        border: 1px solid var(--border-secondary);
        transform: translateX(-8px);
        
        &--open {
          transform: translateX(0);
        }
        
        /* Third level dropdowns */
        .nav__dropdown {
          background: var(--bg-quaternary);
          border: 1px solid var(--border-tertiary);
        }
      }
      
      /* Dropdown items styling */
      .nav__item {
        margin: 0;
        
        &:first-child .nav__link {
          border-top-left-radius: var(--nav-submenu-radius);
          border-top-right-radius: var(--nav-submenu-radius);
        }
        
        &:last-child .nav__link {
          border-bottom-left-radius: var(--nav-submenu-radius);
          border-bottom-right-radius: var(--nav-submenu-radius);
        }
      }
      
      .nav__link {
        padding: var(--spacing-12) var(--spacing-16);
        border-radius: 0;
        background: transparent;
        color: var(--text-secondary);
        font-size: var(--text-sm);
        
        &:hover {
          background: var(--nav-submenu-link-hover-bg);
          color: var(--nav-link-hover-color);
        }
      }
      
      .nav__item--active .nav__link {
        color: var(--nav-link-active-color);
        font-weight: 600;
      }
    }
  }
  
  &--vertical {
    .nav__list {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-4);
    }
    
    .nav__dropdown {
      position: static;
      background: var(--bg-secondary);
      border: 1px solid var(--border-primary);
      border-radius: var(--gl-radius-btn);
      margin-top: var(--spacing-8);
      padding: var(--spacing-8);
      max-height: 0;
      overflow: hidden;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      
      &--open {
        max-height: 500px;
      }
      
      /* Nested vertical dropdowns */
      .nav__dropdown {
        background: var(--bg-tertiary);
        border-color: var(--border-secondary);
      }
    }
  }
  
  &--tabs {
    border-bottom: 2px solid var(--color-border);
    
    .nav__list {
      display: flex;
      gap: 0;
    }
    
    .nav__link {
      border-radius: 0;
      border-bottom: 3px solid transparent;
      padding-bottom: var(--spacing-16);
      
      &:hover {
        background: none;
        border-bottom-color: var(--nav-link-hover-color);
      }
    }
    
    .nav__item--active .nav__link {
      background: none;
      border-bottom-color: var(--nav-link-active-color);
      color: var(--nav-link-active-color);
      font-weight: 600;
    }
  }
  
  &--pills {
    .nav__list {
      display: flex;
      gap: var(--spacing-8);
      background: var(--color-surface-secondary);
      padding: var(--spacing-4);
      border-radius: var(--gl-radius-wrapper);
    }
    
    .nav__link {
      border-radius: var(--gl-radius-btn);
      
      &:hover {
        background: transparent;
      }
    }
    
    .nav__item--active .nav__link {
      color: var(--nav-link-active-color);
      font-weight: 600;
    }
  }
  
  /* ===== Sizes ===== */
  &--sm {
    .nav__link {
      padding: var(--spacing-8) var(--spacing-12);
      font-size: var(--text-sm);
    }
    
    .nav__icon {
      width: var(--spacing-16);
      height: var(--spacing-16);
    }
  }
  
  &--md {
    .nav__link {
      padding: var(--spacing-12) var(--spacing-16);
      font-size: var(--text-base);
    }
    
    .nav__icon {
      width: var(--spacing-20);
      height: var(--spacing-20);
    }
  }
  
  &--lg {
    .nav__link {
      padding: var(--spacing-16) var(--spacing-24);
      font-size: var(--text-lg);
    }
    
    .nav__icon {
      width: var(--spacing-24);
      height: var(--spacing-24);
    }
  }
  
  /* ===== Sticky Navigation ===== */
  &--sticky {
    position: sticky;
    top: 0;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    z-index: var(--z-sticky);
  }
  
  /* ===== Collapsed State ===== */
  &--collapsed {
    .nav__list {
      display: none;
    }
    
    @media (max-width: 768px) {
      .nav__list {
        display: flex;
        flex-direction: column;
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: var(--nav-mobile-bg);
        border: 1px solid var(--nav-mobile-border);
        border-radius: var(--nav-mobile-radius);
        box-shadow: var(--nav-mobile-shadow);
        padding: var(--spacing-16);
        gap: var(--spacing-8);
      }
    }
  }
}

/* ===== Navigation List ===== */
.nav__list {
  list-style: none;
  margin: 0;
  padding: 0;
}

/* ===== Navigation Items ===== */
.nav__item {
  position: relative;
  
  &--disabled {
    opacity: 0.5;
    pointer-events: none;
  }
  
  &--has-children {
    .nav__link {
      position: relative;
    }
  }
  
  &--level-1 {
    .nav__link {
      padding-left: var(--spacing-32);
      font-size: var(--text-sm);
      color: var(--color-text-secondary);
    }
  }
  
  &--level-2 {
    .nav__link {
      padding-left: var(--spacing-48);
      font-size: var(--text-sm);
      color: var(--color-text-muted);
    }
  }
}

/* ===== Navigation Links ===== */
.nav__link {
  display: flex;
  align-items: center;
  gap: var(--spacing-8);
  padding: var(--nav-link-padding);
  color: var(--nav-link-color);
  text-decoration: none;
  font-weight: 500;
  border-radius: var(--nav-link-radius);
  transition: var(--nav-link-transition);
  min-height: var(--nav-link-min-height);
  position: relative;
  overflow: hidden;
  border: none;
  background: none;
  cursor: pointer;
  width: 100%;
  
  /* Minimal design - no shine effect */
  
  &:hover {
    background: var(--nav-link-hover-bg);
    color: var(--nav-link-hover-color);
  }
  
  &:focus-visible {
    outline: 2px solid var(--nav-link-focus-ring);
    outline-offset: 2px;
  }
  
  &--external {
    .nav__external-icon {
      opacity: 0.6;
      transition: opacity 0.2s ease;
    }
    
    &:hover .nav__external-icon {
      opacity: 1;
    }
  }
}

/* Minimal design - no transform or shadow effects for dropdown triggers */

/* Create a hover bridge between trigger and submenu */
.nav__item--has-children {
  & > .nav__link::after {
    content: '';
    position: absolute;
    left: 0;
    right: 0;
    bottom: -8px;
    height: 8px;
    /* bridge area shouldn't block clicks */
    pointer-events: none;
  }

  /* For nested submenus (right side), add a side bridge */
  & > .nav__dropdown {
    &::before {
      content: '';
      position: absolute;
      top: 0;
      left: -8px;
      width: 8px;
      bottom: 0;
      pointer-events: none;
    }
  }
}

/* ===== Active State ===== */
.nav__item--active {
  .nav__link {
    color: var(--nav-link-active-color);
    font-weight: 600;
  }
}

/* ===== Navigation Elements ===== */
.nav__icon {
  flex-shrink: 0;
  transition: transform 0.2s ease;
}

.nav__label {
  flex: 1;
  white-space: nowrap;
}

.nav__badge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: var(--spacing-20);
  height: var(--spacing-20);
  padding: 0 var(--spacing-6);
  background: var(--color-danger);
  color: white;
  font-size: var(--text-xs);
  font-weight: 600;
  border-radius: var(--gl-radius-full);
  line-height: 1;
}

.nav__chevron {
  flex-shrink: 0;
  margin-left: var(--spacing-8);
  transition: transform 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

.nav__external-icon {
  flex-shrink: 0;
  width: var(--spacing-12);
  height: var(--spacing-12);
}

/* ===== Toggle Button ===== */
.nav__toggle {
  display: none;
  align-items: center;
  justify-content: center;
  width: var(--nav-toggle-size);
  height: var(--nav-toggle-size);
  padding: 0;
  background: none;
  border: 1px solid var(--color-border);
  border-radius: var(--gl-radius-btn);
  color: var(--nav-toggle-line-color);
  cursor: pointer;
  transition: var(--nav-toggle-transition);
  
  &:hover {
    background: var(--nav-toggle-hover-bg);
    border-color: var(--color-primary);
  }
  
  &:focus-visible {
    outline: 2px solid var(--nav-toggle-focus-ring);
    outline-offset: 2px;
  }
  
  @media (max-width: 768px) {
    display: flex;
  }
}

/* ===== Dropdown Menu ===== */
.nav__dropdown {
  list-style: none;
  margin: 0;
  padding: var(--spacing-8);
  
  .nav__link {
    border-radius: var(--gl-radius-btn);
    
    &:hover {
      background: var(--nav-submenu-link-hover-bg);
    }
  }
}

/* ===== Responsive Design ===== */
@media (max-width: 1024px) {
  .nav {
    &--horizontal {
      .nav__list {
        gap: var(--nav-gap-tablet);
      }
    }
  }
  
  .nav__link {
    padding: var(--nav-link-padding-tablet);
    font-size: var(--nav-link-font-size-tablet);
  }
}

@media (max-width: 768px) {
  .nav {
    &--horizontal {
      .nav__list {
        flex-direction: column;
        gap: var(--nav-gap-mobile);
      }
      
      .nav__dropdown {
        position: static;
        box-shadow: none;
        border: 1px solid var(--border-primary);
        background: var(--bg-secondary);
        margin-top: var(--spacing-8);
        
        /* Nested mobile dropdowns */
        .nav__dropdown {
          background: var(--bg-tertiary);
          border-color: var(--border-secondary);
        }
      }
    }
    
    // Ensure chevron rotation works on mobile - Main level only
    > .nav__list > .nav__item--has-children {
      &.nav__item--dropdown-open > .nav__link .nav__chevron {
        transform: rotate(180deg);
      }
    }
    
    /* Nested dropdown chevrons rotate -90deg for side opening on mobile */
    .nav__dropdown .nav__item--has-children {
      &.nav__item--dropdown-open > .nav__link .nav__chevron {
        transform: rotate(-90deg);
      }
    }
  }
  
  .nav__link {
    padding: var(--nav-link-padding-mobile);
    font-size: var(--nav-link-font-size-mobile);
  }
  
  .nav__label {
    white-space: normal;
  }
  
  .nav__chevron {
    margin-left: var(--spacing-12);
  }
}

/* ===== Accessibility ===== */
@media (prefers-reduced-motion: reduce) {
  .nav__link,
  .nav__chevron,
  .nav__dropdown {
    transition: none;
  }
  
  .nav__link::before {
    display: none;
  }
}

/* ===== High Contrast Mode ===== */
@media (prefers-contrast: high) {
  .nav__link {
    border: 1px solid transparent;
    
    &:hover,
    &:focus-visible {
      border-color: currentColor;
    }
  }
  
  .nav__item--active .nav__link {
    border-color: currentColor;
  }
}
