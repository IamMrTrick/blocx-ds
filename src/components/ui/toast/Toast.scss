@use '../../../styles/tokens/colors';
@use '../../../styles/tokens/spacing';
@use '../../../styles/tokens/radius';
@use '../../../styles/tokens/transitions';
@use '../../../styles/tokens/zindex';

// Sonner-style optimized CSS properties
:root {
  --toast-shadow-primary: 0 10px 38px -10px var(--transparent-black-35);
  --toast-shadow-secondary: 0 10px 20px -15px var(--transparent-black-20);
  --toast-transition-fast: all 0.15s cubic-bezier(0.4, 0, 1, 1);
  --toast-transition-sonner: all 0.2s cubic-bezier(0.32, 0.72, 0, 1);
  --toast-stacking-transition: transform 0.2s cubic-bezier(0.32, 0.72, 0, 1);
}

// Clean, Professional Toast Container
.toast-container {
  position: fixed;
  z-index: var(--z-toast);
  pointer-events: none;
  width: 420px;
  max-width: calc(100vw - var(--spacing-32));
  
  // Increased container height when action toasts are present
  &[data-has-action-toasts="true"] {
    // Allow more space for action button toasts
    .toast-list {
      padding-bottom: var(--spacing-16); // Extra bottom padding
    }
  }
  
  // Ensure proper positioning for all variants
  &--center-left,
  &--center-center, 
  &--center-right {
    // Center positions need proper vertical centering
    transform-style: preserve-3d; // For better centering
  }

  // Position variants - Complete 9-grid system
  &--top-left {
    top: var(--spacing-24);
    left: var(--spacing-24);
    
    // Top-left toasts enter from left-bottom
    .toast {
      transform: translate3d(-16px, 32px, 0) scale(0.94);
    }
  }

  &--top-center {
    top: var(--spacing-24);
    left: 50%;
    transform: translateX(-50%);
    
    // Top-center toasts enter from bottom
    .toast {
      transform: translate3d(0, 32px, 0) scale(0.94);
    }
  }

  &--top-right {
    top: var(--spacing-24);
    right: var(--spacing-24);
    
    // Top-right toasts enter from right-bottom (default)
    .toast {
      transform: translate3d(16px, 32px, 0) scale(0.94);
    }
  }



  &--bottom-left {
    bottom: 80px; // Increase bottom spacing significantly
    left: var(--spacing-24);
    max-height: calc(100vh - 120px); // Adjust for larger bottom spacing
    overflow: visible;
    height: auto;
    
    .toast-list {
      display: flex;
      flex-direction: column-reverse; // Newest at bottom visually, older toasts stack upward
      align-items: flex-start;
      min-height: 0;
    }
    
    .toast {
      transform: translate3d(0, 16px, 0) scale(0.94); // Reduce entry distance
      transform-origin: center; // Use center origin instead of bottom
      margin-bottom: 0 !important;
    }
  }

  &--bottom-center {
    bottom: 80px;
    left: 50%;
    transform: translateX(-50%);
    max-height: calc(100vh - 120px);
    overflow: visible;
    height: auto;
    
    .toast-list {
      display: flex;
      flex-direction: column-reverse; // Newest at bottom visually, older toasts stack upward
      align-items: center;
      min-height: 0;
    }
    
    .toast {
      transform: translate3d(0, 16px, 0) scale(0.94);
      transform-origin: center;
      margin-bottom: 0 !important;
    }
  }

  &--bottom-right {
    bottom: 80px;
    right: var(--spacing-24);
    max-height: calc(100vh - 120px);
    overflow: visible;
    height: auto;
    
    .toast-list {
      display: flex;
      flex-direction: column-reverse; // Newest at bottom visually, older toasts stack upward
      align-items: flex-end;
      min-height: 0;
    }
    
    .toast {
      transform: translate3d(0, 16px, 0) scale(0.94);
      transform-origin: center;
      margin-bottom: 0 !important;
    }
  }
}

// Toast List
.toast-list {
  position: relative;
  list-style: none;
  margin: 0;
  padding: 0;
  outline: none;
}

// Individual Toast
.toast {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  pointer-events: auto; // Ensure toast is interactive
  background: var(--bg-primary);
  border: 1px solid var(--border-light);
  border-radius: var(--radius-12);
  box-shadow: var(--toast-shadow-primary), var(--toast-shadow-secondary);
  width: 100%;
  max-width: 420px;
  min-height: 64px;
  overflow: hidden;
  cursor: grab;
  user-select: none;
  touch-action: pan-x;
    // Enhanced smooth transitions for perfect step repositioning
    transition: 
      transform 0.4s cubic-bezier(0.32, 0.72, 0, 1),
      opacity 0.3s ease,
      box-shadow 0.25s ease,
      z-index 0s; // Instant z-index changes
    transform-origin: center;
    will-change: transform, opacity;



  // Clean Sonner-style initial state
  opacity: 0;
  transform: translate3d(0, 20px, 0) scale(0.95); // Simple bottom entry

  &--mounted {
    opacity: 1;
    transform: translate3d(0, 0, 0) scale(1);
  }

  // Sonner-style fast animations for all types
  &--success.toast--mounted {
    animation: toast-success-gentle 0.2s cubic-bezier(0.32, 0.72, 0, 1);
  }

  &--error.toast--mounted {
    animation: toast-error-shake 0.25s cubic-bezier(0.32, 0.72, 0, 1);
  }

  &--warning.toast--mounted {
    animation: toast-warning-pulse 0.2s cubic-bezier(0.32, 0.72, 0, 1);
  }

  &--info.toast--mounted {
    animation: toast-info-slide 0.2s cubic-bezier(0.32, 0.72, 0, 1);
  }

  &--loading.toast--mounted {
    animation: toast-loading-breathe 0.3s cubic-bezier(0.32, 0.72, 0, 1);
  }

  &--default.toast--mounted {
    animation: toast-info-slide 0.2s cubic-bezier(0.32, 0.72, 0, 1);
  }

  // Dragging state
  &--dragging {
    cursor: grabbing;
    transition: none;
  }

  // Clean removing animation like Sonner
  &--removing {
    transform: translate3d(0, -20px, 0) scale(0.9);
    opacity: 0;
    pointer-events: none;
  }

  // Clean Sonner-style hover
  &:hover {
    transform: translateY(-2px) scale(1.02);
    box-shadow: 
      var(--toast-shadow-primary),
      var(--toast-shadow-secondary),
      0 8px 30px -8px var(--transparent-black-30);
    z-index: 1100 !important;
  }
  


  // Enhanced hover for toasts with actions (using class instead of :has)
  &--has-actions:hover {
    transform: translateY(-1px) scale(1.01); // Very subtle for taller toasts
    
    // Minimal push effect for following toasts to prevent overlap
    ~ .toast {
      transform: translateY(1px) scale(0.999);
      transition: all 0.08s ease-out;
    }
    

  }

  // Simple stacked hover like Sonner
  &--stacked:hover {
    transform: translateY(-2px) scale(1.02);
    
    // Simple push for other stacked toasts
    ~ .toast--stacked {
      transform: translateY(1px) scale(0.98);
    }
  }
  
  // Enhanced hover for action toasts in stack
  &--stacked.toast--has-actions:hover {
    transform: translateY(-1px) scale(1.015); // Subtle lift for tall toasts
    
    // Minimal push to preserve step definition
    ~ .toast--stacked {
      transform: translateY(1px) scale(0.995);
      transition: all 0.1s ease-out;
    }
    

  }



  // Enhanced styling for toasts with action buttons
  &--has-actions {
    // Slightly increased min-height for action button space
    min-height: 80px; // Up from 64px
    
    // Better spacing when stacked with more prominent shadow
    &.toast--stacked {
      box-shadow: 
        0 4px 14px -4px var(--transparent-black-25),
        0 8px 20px -10px var(--transparent-black-20),
        inset 0 1px 0 0 var(--border-light); // Subtle top border for separation
    }
  }

  // Enhanced stacked toast styling with better step definition
  &--stacked {
    // Progressive shadow for depth and step visibility
    box-shadow: 
      0 3px 12px -3px var(--transparent-black-20),
      0 6px 16px -8px var(--transparent-black-15),
      inset 0 1px 0 0 var(--border-light); // Top border for step definition
    
    // Subtle background tint for better separation (with fallback)
    background: var(--bg-primary);
    background: color-mix(in srgb, var(--bg-primary) 95%, var(--bg-secondary) 5%);
    
    // More defined border for stacked toasts
    border-color: var(--border-secondary);
  }

  // Active state
  &:active {
    cursor: grabbing;
    transform: translateY(0) scale(1);
  }

  // Focus state for accessibility
  &:focus {
    outline: 2px solid var(--primary-05);
    outline-offset: 2px;
  }

  // Content wrapper
  &__content {
    display: flex;
    align-items: flex-start;
    gap: var(--spacing-12);
    padding: var(--spacing-16) var(--spacing-20);
    position: relative;
  }

  // Icon with micro-animations
  &__icon {
    width: var(--spacing-20);
    height: var(--spacing-20);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    margin-top: var(--spacing-2);
    
    svg {
      width: var(--spacing-16);
      height: var(--spacing-16);
      transition: transform 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
  }

  // Sonner-style immediate icon animations
  &--mounted &__icon svg {
    animation-delay: 0.05s; // Very short delay like Sonner
    animation-fill-mode: both;
  }

  // Sonner-style fast icon animations  
  &--success.toast--mounted &__icon svg {
    animation: icon-gentle-fade 0.15s ease-out;
  }

  &--error.toast--mounted &__icon svg {
    animation: icon-error-shake 0.2s ease-out;
  }

  &--warning.toast--mounted &__icon svg {
    animation: icon-warning-pulse 0.2s ease-out;
  }

  &--info.toast--mounted &__icon svg {
    animation: icon-info-slide 0.15s ease-out;
  }

  &--loading.toast--mounted &__icon svg {
    animation: icon-gentle-fade 0.15s ease-out;
  }

  // Text content
  &__text {
    flex: 1;
    min-width: 0;
  }

  &__title {
    font-weight: 600;
    font-size: var(--text-sm);
    line-height: 1.4;
    color: var(--text-primary);
    margin: 0;
  }

  &__description {
    font-size: var(--text-xs);
    line-height: 1.4;
    color: var(--text-secondary);
    margin-top: var(--spacing-4);
  }

  // Enhanced Actions Container
  &__actions {
    display: flex;
    gap: var(--spacing-8);
    margin-top: var(--spacing-12);
    flex-wrap: wrap;
    align-items: center;
    justify-content: flex-start;
  }

  // Action Buttons using Button Component
  &__action-button {
    // Override button styles for toast context
    min-height: 28px !important;
    padding: var(--spacing-6) var(--spacing-12) !important;
    font-size: var(--text-xs) !important;
    font-weight: 500 !important;
    border-radius: var(--radius-6) !important;
    flex-shrink: 0;
    
    // Primary action styling
    &--primary {
      order: 1;
    }
    
    // Secondary action styling  
    &--secondary {
      order: 2;
    }
    
    // Hover enhancement for action buttons in toasts
    &:hover {
      transform: translateY(-1px) scale(1.02);
      box-shadow: 0 2px 8px -2px var(--transparent-black-25);
    }
    
    &:active {
      transform: translateY(0) scale(0.98);
    }
  }

  // Legacy action button (deprecated - use Button component)
  &__action {
    background: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    border-radius: var(--radius-6);
    padding: var(--spacing-6) var(--spacing-12);
    font-size: var(--text-xs);
    font-weight: 500;
    color: var(--text-primary);
    cursor: pointer;
    transition: var(--toast-transition-fast);
    margin-top: var(--spacing-8);
    flex-shrink: 0;

    &:hover {
      background: var(--bg-tertiary);
      border-color: var(--border-secondary);
    }

    &:active {
      transform: scale(0.98);
    }
  }

  // Close button container
  &__close-container {
    width: var(--spacing-24);
    height: var(--spacing-24);
    position: relative;
    flex-shrink: 0;
    pointer-events: auto;
    z-index: 100;
  }

  // Clean close button (no progress ring inside)
  &__close {
    width: var(--spacing-24);
    height: var(--spacing-24);
    display: flex;
    align-items: center;
    justify-content: center;
    background: transparent;
    border: none;
    border-radius: var(--radius-4);
    color: var(--text-tertiary);
    cursor: pointer;
    transition: var(--toast-transition-fast);
    flex-shrink: 0;
    position: relative;
    pointer-events: auto;
    z-index: 101;
    
    &:hover {
      background: var(--bg-secondary);
      color: var(--text-secondary);
      transform: scale(1.05);
    }

    &:active {
      transform: scale(0.9);
      background: var(--bg-tertiary);
    }
    
    &:focus {
      outline: 2px solid var(--primary-05);
      outline-offset: 2px;
    }
  }

  // Progress ring (separate from button)
  &__progress-ring {
    position: absolute;
    top: 0;
    left: 0;
    width: var(--spacing-24);
    height: var(--spacing-24);
    pointer-events: none;
    z-index: 20; // Below button but visible
  }

  &__progress-ring-bg {
    opacity: 0.2;
    stroke: currentColor;
  }

  &__progress-ring-progress {
    opacity: 0.8;
    stroke: currentColor;
  }



  // Loading spinner
  &__spinner {
    animation: toast-spin 1s linear infinite;
  }

  // Toast Types
  &--success {
    border-color: var(--success-06);
    
    .toast__icon {
      color: var(--success-09);
    }
  }

  &--error {
    border-color: var(--error-06);
    
    .toast__icon {
      color: var(--error-09);
    }
  }

  &--warning {
    border-color: var(--warning-06);
    
    .toast__icon {
      color: var(--warning-09);
    }
  }

  &--info {
    border-color: var(--info-06);
    
    .toast__icon {
      color: var(--info-09);
    }
  }

  &--loading {
    border-color: var(--primary-06);
    
    .toast__icon {
      color: var(--primary-09);
    }
  }

  &--default {
    .toast__icon {
      color: var(--text-secondary);
    }
  }
}

// Enhanced Animations with spectacular effects
@keyframes toast-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

// Toast entrance animations (restored but refined)

// Sonner-style success animation
@keyframes toast-success-gentle {
  0% {
    transform: translate3d(0, 32px, 0) scale(0.94);
    opacity: 0;
  }
  100% {
    transform: translate3d(0, 0, 0) scale(1);
    opacity: 1;
  }
}

// Sonner-style error animation
@keyframes toast-error-shake {
  0% {
    transform: translate3d(0, 32px, 0) scale(0.94);
    opacity: 0;
  }
  50% {
    transform: translate3d(-2px, 0, 0) scale(1);
    opacity: 1;
  }
  100% {
    transform: translate3d(0, 0, 0) scale(1);
    opacity: 1;
  }
}

// Sonner-style warning animation
@keyframes toast-warning-pulse {
  0% {
    transform: translate3d(0, 32px, 0) scale(0.94);
    opacity: 0;
  }
  100% {
    transform: translate3d(0, 0, 0) scale(1);
    opacity: 1;
  }
}

// Sonner-style info animation
@keyframes toast-info-slide {
  0% {
    transform: translate3d(0, 32px, 0) scale(0.94);
    opacity: 0;
  }
  100% {
    transform: translate3d(0, 0, 0) scale(1);
    opacity: 1;
  }
}

// Sonner-style loading animation
@keyframes toast-loading-breathe {
  0% {
    transform: translate3d(0, 32px, 0) scale(0.94);
    opacity: 0;
  }
  100% {
    transform: translate3d(0, 0, 0) scale(1);
    opacity: 1;
  }
}

// Icon animations (restored and refined)
@keyframes icon-gentle-fade {
  0% {
    transform: scale(0.9);
    opacity: 0;
  }
  100% {
    transform: scale(1);
    opacity: 1;
  }
}

@keyframes icon-error-shake {
  0%, 100% {
    transform: translateX(0);
  }
  25% {
    transform: translateX(-1.5px);
  }
  75% {
    transform: translateX(1.5px);
  }
}

@keyframes icon-warning-pulse {
  0%, 100% {
    transform: scale(1);
    opacity: 1;
  }
  50% {
    transform: scale(1.1);
    opacity: 0.9;
  }
}

@keyframes icon-info-slide {
  0% {
    transform: translateX(-5px) scale(0.95);
    opacity: 0;
  }
  100% {
    transform: translateX(0) scale(1);
    opacity: 1;
  }
}



// Responsive adjustments
@media (max-width: 640px) {
  .toast-container {
    left: var(--spacing-16) !important;
    right: var(--spacing-16) !important;
    width: auto;
    max-width: none;
    
    // Disable hover on mobile
    &:hover {
      pointer-events: none;
    }
    
    &--top-center,
    &--bottom-center {
      transform: none;
    }
    
    &--center-left,
    &--center-right,
    &--center-center {
      top: var(--spacing-24) !important;
      bottom: auto !important;
      transform: none !important;
      
      // Reset toast direction on mobile
      .toast-list {
        flex-direction: column !important;
      }
      
      .toast {
        transform: translate3d(0, 32px, 0) scale(0.94) !important;
      }
    }
    
    &--center-center {
      left: var(--spacing-16) !important;
      right: var(--spacing-16) !important;
    }
    
    // Bottom positions stay at bottom but with limited height
    &--bottom-left,
    &--bottom-center, 
    &--bottom-right {
      bottom: var(--spacing-16) !important;
      max-height: 80vh; // Prevent overflow
      overflow-y: auto;
    }
  }

  .toast {
    max-width: none;
    touch-action: pan-x;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    user-select: none;
    
    &__content {
      padding: var(--spacing-14) var(--spacing-16);
    }
    
    // Mobile adjustments for action buttons
    &__actions {
      margin-top: var(--spacing-10);
      gap: var(--spacing-6);
      
      // Stack action buttons on very small screens
      flex-direction: column;
      width: 100%;
    }
    
    &__action-button {
      width: 100% !important;
      justify-content: center !important;
      min-height: 32px !important;
    }
    
    // Increased spacing for action toasts on mobile
    &--has-actions {
      min-height: 100px; // More space needed on mobile
    }
  }
}

// Disable hover on touch devices
@media (hover: none) {
  .toast-container {
    &:hover {
      pointer-events: none;
    }
  }
}

// Clean up old classes
[data-sonner-toaster],
[data-sonner-toast],
[data-sonner-toasts] {
  display: none !important;
}